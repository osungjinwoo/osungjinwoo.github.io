<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artigos | Shadow Monarch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <!-- Marked.js para renderização de Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <!-- DOMPurify para sanitização de HTML -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.1/dist/purify.min.js"></script>
    <!-- Prism.js para highlight de código -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
    <style>
        /* Estilos específicos para a página de artigos */
        .articles-section {
            padding: 120px 0 80px;
        }

        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .category-btn {
            padding: 8px 20px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .category-btn.active, .category-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
        }

        .article-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .article-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .article-image {
            height: 200px;
            overflow: hidden;
        }

        .article-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .article-card:hover .article-image img {
            transform: scale(1.1);
        }

        .article-content {
            padding: 20px;
        }

        .article-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #a0a0a0;
        }

        .article-meta span {
            display: flex;
            align-items: center;
        }

        .article-meta i {
            margin-right: 5px;
            color: var(--accent-color);
        }

        .article-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .article-excerpt {
            font-size: 14px;
            color: #a0a0a0;
            line-height: 1.6;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 62, 120, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s infinite linear;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Modal de Artigo */
        .article-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }

        .article-modal.glitch {
            animation: glitch 0.5s ease-in-out;
        }

        @keyframes glitch {
            0%, 100% {
                transform: translateY(0);
            }
            2%, 6% {
                transform: translate(-2px, -2px);
            }
            4%, 8% {
                transform: translate(2px, 2px);
            }
        }

        .article-modal-content {
            background: var(--dark-color);
            border-radius: 10px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .article-modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--dark-color);
            z-index: 10;
        }

        .article-modal-header h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 28px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close-btn:hover {
            color: var(--accent-color);
        }

        .article-modal-body {
            padding: 20px;
        }

        .article-modal-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #a0a0a0;
        }

        .article-modal-featured-image {
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
        }

        .article-modal-featured-image img {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
        }

        .article-modal-content-body {
            line-height: 1.8;
            font-size: 16px;
        }

        .article-modal-content-body h1,
        .article-modal-content-body h2,
        .article-modal-content-body h3,
        .article-modal-content-body h4,
        .article-modal-content-body h5,
        .article-modal-content-body h6 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .article-modal-content-body p {
            margin-bottom: 20px;
        }

        .article-modal-content-body a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .article-modal-content-body a:hover {
            text-decoration: underline;
        }

        .article-modal-content-body img {
            max-width: 100%;
            border-radius: 5px;
            margin: 20px 0;
        }

        .article-modal-content-body pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
        }

        .article-modal-content-body code {
            font-family: 'Courier New', Courier, monospace;
        }

        .article-modal-content-body blockquote {
            border-left: 4px solid var(--accent-color);
            padding-left: 20px;
            margin-left: 0;
            margin-right: 0;
            font-style: italic;
            color: #a0a0a0;
        }

        .article-modal-content-body ul,
        .article-modal-content-body ol {
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .article-modal-content-body li {
            margin-bottom: 10px;
        }

        /* Estilos para os blocos de prompt */
        .prompt-info,
        .prompt-tip,
        .prompt-warning,
        .prompt-danger {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            position: relative;
            padding-left: 50px;
        }

        .prompt-info::before,
        .prompt-tip::before,
        .prompt-warning::before,
        .prompt-danger::before {
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            left: 15px;
            top: 15px;
            font-size: 20px;
        }

        .prompt-info {
            background: rgba(0, 123, 255, 0.1);
            border-left: 4px solid #0d6efd;
        }

        .prompt-info::before {
            content: '\f05a';
            color: #0d6efd;
        }

        .prompt-tip {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }

        .prompt-tip::before {
            content: '\f0eb';
            color: #28a745;
        }

        .prompt-warning {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
        }

        .prompt-warning::before {
            content: '\f071';
            color: #ffc107;
        }

        .prompt-danger {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
        }

        .prompt-danger::before {
            content: '\f06a';
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .articles-grid {
                grid-template-columns: 1fr;
            }

            .article-modal-content {
                max-height: 95vh;
            }

            .article-modal-header h2 {
                font-size: 20px;
            }
        }

        /* Estilo para seleção de texto */
        ::selection {
            background-color: var(--accent-color);
            color: white;
        }

        ::-moz-selection {
            background-color: var(--accent-color);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">
                    <span></span>
                </a>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="links.html">Links</a>
                    <a href="artigos.html" class="active">Artigos</a>
                    <div class="dropdown">
                        <a href="#" class="dropdown-trigger">Cheatsheets <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="python.html">Python</a>
                            <a href="bash.html">Bash</a>
                        </div>
                    </div>
                </div>
                <div class="auth-buttons">
                </div>
            </nav>
        </div>
    </header>

    <section class="articles-section">
        <div class="container">
            <div class="section-title">
                <h2>Artigos Recentes</h2>
                <p>Aqui você tem acesso aos meus artigos</p>
            </div>

            <div id="category-filter" class="category-filter">
                <!-- Categorias serão adicionadas dinamicamente -->
                <button class="category-btn active" data-category="all">Todos</button>
            </div>

            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
            </div>

            <div id="articles-container" class="articles-grid">
                <!-- Artigos serão adicionados dinamicamente -->
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="index.html" class="logo">
                        <span>S</span>
                    </a>
                    <p class="footer-description">
                        Compartilhando conhecimento e técnicas de segurança cibernética para um mundo digital mais seguro.
                    </p>
                    <div class="footer-social">
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3 class="footer-title">Contato</h3>
                    <ul>
                        <li><a href="mailto:contato@shadowmonarch.com"><i class="fas fa-envelope"></i> contato@shadowmonarch.com</a></li>
                        <li><a href="tel:+5511999999999"><i class="fas fa-phone"></i> +55 (11) 99999-9999</a></li>
                        <li><a href="https://maps.google.com/?q=São+Paulo,Brasil" target="_blank"><i class="fas fa-map-marker-alt"></i> São Paulo, Brasil</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Shadow Monarch. Todos os direitos reservados.</p>
                <a href="#" class="back-to-top" aria-label="Voltar ao topo"><i class="fas fa-arrow-up"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Configurar o Marked.js para suportar recursos do Jekyll
        marked.setOptions({
            renderer: new marked.Renderer(),
            highlight: function(code, lang) {
                if (Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                } else {
                    return code;
                }
            },
            pedantic: false,
            gfm: true,
            breaks: true,
            sanitize: false,
            smartypants: true,
            xhtml: true
        });

        // Estender o renderer do Marked para suportar recursos adicionais do Jekyll
        const renderer = new marked.Renderer();

        // Suporte para notas de rodapé
        const footnotes = {};
        let footnoteIndex = 0;

        // Personalizar o renderizador para suportar os blocos de prompt do Jekyll
        renderer.paragraph = function(text) {
            // Processar blocos de prompt (info, tip, warning, danger)
            if (text.includes('{: .prompt-info }')) {
                return `<div class="prompt-info">${text.replace('{: .prompt-info }', '')}</div>`;
            } else if (text.includes('{: .prompt-tip }')) {
                return `<div class="prompt-tip">${text.replace('{: .prompt-tip }', '')}</div>`;
            } else if (text.includes('{: .prompt-warning }')) {
                return `<div class="prompt-warning">${text.replace('{: .prompt-warning }', '')}</div>`;
            } else if (text.includes('{: .prompt-danger }')) {
                return `<div class="prompt-danger">${text.replace('{: .prompt-danger }', '')}</div>`;
            }

            return `<p>${text}</p>`;
        };

        // Personalizar o renderizador para links
        renderer.link = function(href, title, text) {
            // Converter links relativos para o formato correto
            if (href && href.startsWith('/posts/')) {
                href = href.replace('/posts/', '');
                // Remover a extensão .md se existir
                href = href.replace('.md', '');
                // Construir o link para o artigo
                href = `?article=${href}`;
            }
            
            const titleAttr = title ? `title="${title}"` : '';
            return `<a href="${href}" ${titleAttr}>${text}</a>`;
        };

        // Personalizar o renderizador para imagens
        renderer.image = function(href, title, text) {
            // Corrigir caminhos de imagem relativos
            if (href && !href.startsWith('http') && !href.startsWith('/')) {
                // Assumir que a imagem está na pasta img
                if (!href.startsWith('img/')) {
                    href = `img/${href}`;
                }
            }
            
            const titleAttr = title ? `title="${title}"` : '';
            return `<img src="${href}" alt="${text}" ${titleAttr}>`;
        };

        // Função para extrair metadados do markdown (front matter)
        function extractFrontMatter(markdown) {
            const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n/;
            const match = markdown.match(frontMatterRegex);

            if (!match) return { content: markdown, metadata: {} };

            const frontMatter = match[1];
            const content = markdown.slice(match[0].length);
            const metadata = {};

            // Processar o front matter linha por linha
            const lines = frontMatter.split('\n');
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Verificar se a linha contém um par chave-valor
                const colonIndex = line.indexOf(':');
                if (colonIndex !== -1) {
                    const key = line.slice(0, colonIndex).trim();
                    let value = line.slice(colonIndex + 1).trim();
                    
                    // Remover aspas se existirem
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }

                    // Verificar se é um objeto aninhado (como image)
                    if (i + 1 < lines.length && lines[i + 1].trim().match(/^\s+\w+:/)) {
                        metadata[key] = {};
                        i++;
                        while (i < lines.length && lines[i].trim().match(/^\s+\w+:/)) {
                            const nestedLine = lines[i].trim();
                            const nestedColonIndex = nestedLine.indexOf(':');
                            const nestedKey = nestedLine.slice(0, nestedColonIndex).trim();
                            let nestedValue = nestedLine.slice(nestedColonIndex + 1).trim();
                            
                            // Remover aspas se existirem
                            if (nestedValue.startsWith('"') && nestedValue.endsWith('"')) {
                                nestedValue = nestedValue.slice(1, -1);
                            }
                            
                            metadata[key][nestedKey] = nestedValue;
                            i++;
                        }
                        i--; // Voltar um para compensar o incremento do loop principal
                    } else {
                        // Processar arrays (tags, categorias)
                        if (value.startsWith('[') && value.endsWith(']')) {
                            metadata[key] = value.slice(1, -1).split(',').map(item => item.trim().replace(/"/g, ''));
                        } else {
                            metadata[key] = value;
                        }
                    }
                }
            }

            return { content, metadata };
        }

        // Função para listar arquivos da pasta blog/
        async function listArticleFiles() {
            try {
                // Em um ambiente real, isso seria uma chamada para uma API no servidor
                // que retornaria a lista de arquivos disponíveis
                
                // Simulação de uma resposta de API
                const response = await fetch('api/list-articles.json')
                    .catch(() => {
                        console.log('API de listagem não disponível, usando lista estática');
                        // Fallback para lista estática se a API não estiver disponível
                        return {
                            ok: false
                        };
                    });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.files;
                } else {
                    // Fallback: lista estática de artigos
                    console.log('Usando lista estática de artigos');
                    return [
                        'blog/2023-09-08-fale-comigo-canal-irc.md',
                        'blog/2023-09-09-comandos-Irssi.md',
                        'blog/2023-09-10-hexchat-irc.md',
                        'blog/2023-09-13-applejuicy.md',
                        'blog/2023-09-22-os-hackers-no-mundo.md',
                        'blog/2023-09-29-fbi-hackeado-por-um-troll.md',
                        'blog/2024-01-07-seu-celular-te-vigia.md',
                        'blog/seu-celular-te-vigia.md',
                        'blog/2024-11-17-os-segredos-do-shodan.md'
                    ];
                }
            } catch (error) {
                console.error('Erro ao listar arquivos:', error);
                // Fallback: lista estática de artigos em caso de erro
                console.log('Erro ao listar arquivos, usando lista estática');
                return [
                    'blog/2023-09-08-fale-comigo-canal-irc.md',
                    'blog/2023-09-09-comandos-Irssi.md',
                    'blog/2023-09-10-hexchat-irc.md',
                    'blog/2023-09-13-applejuicy.md',
                    'blog/2023-09-22-os-hackers-no-mundo.md',
                    'blog/2023-09-29-fbi-hackeado-por-um-troll.md',
                    'blog/2024-01-07-seu-celular-te-vigia.md',
                    'blog/seu-celular-te-vigia.md',
                    'blog/2024-11-17-os-segredos-do-shodan.md'
                ];
            }
        }

        // Função para carregar um arquivo markdown
        async function loadMarkdownFile(path) {
            try {
                console.log(`Tentando carregar arquivo: ${path}`);
                const response = await fetch(path);
                
                if (!response.ok) {
                    console.error(`Erro ao carregar ${path}: ${response.status}`);
                    throw new Error(`Erro ao carregar ${path}: ${response.status}`);
                }

                const markdown = await response.text();
                console.log(`Arquivo carregado com sucesso: ${path}`);
                
                const { content, metadata } = extractFrontMatter(markdown);

                // Extrair ID do nome do arquivo
                const filename = path.split('/').pop();
                const id = filename.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace('.md', '');

                // Extrair data do nome do arquivo ou do metadata
                let date = metadata.date;
                if (!date) {
                    const dateMatch = filename.match(/^(\d{4}-\d{2}-\d{2})/);
                    date = dateMatch ? dateMatch[1] : 'Data desconhecida';
                }

                // Formatar a data
                const formattedDate = formatDate(date);

                // Extrair categorias
                let articleCategories = [];
                if (metadata.categories) {
                    if (Array.isArray(metadata.categories)) {
                        articleCategories = metadata.categories;
                    } else if (typeof metadata.categories === 'string') {
                        articleCategories = [metadata.categories];
                    }
                }

                // Adicionar categorias ao conjunto global
                articleCategories.forEach(cat => categories.add(cat.toLowerCase()));

                // Extrair tags
                let tags = [];
                if (metadata.tags) {
                    if (Array.isArray(metadata.tags)) {
                        tags = metadata.tags;
                    } else if (typeof metadata.tags === 'string') {
                        tags = metadata.tags.split(',').map(tag => tag.trim());
                    }
                }

                // Garantir que temos um caminho de imagem válido
                let imagePath = '';
                if (metadata.image && metadata.image.path) {
                    imagePath = metadata.image.path;
                } else if (metadata.image) {
                    imagePath = metadata.image;
                }

                // Corrigir caminho da imagem se necessário
                if (imagePath.startsWith('/')) {
                    imagePath = imagePath.substring(1);
                }

                // Se ainda não temos um caminho de imagem, usar imagem padrão
                if (!imagePath) {
                    imagePath = 'img/default-article.jpg';
                }

                // Extrair resumo
                const excerpt = metadata.excerpt || extractExcerpt(content);

                return {
                    id,
                    title: metadata.title || id,
                    date: formattedDate,
                    rawDate: date, // Para ordenação
                    excerpt,
                    content,
                    categories: articleCategories,
                    tags,
                    imagePath,
                    path
                };
            } catch (error) {
                console.error(`Erro ao carregar ${path}:`, error);
                return null;
            }
        }

        // Função para extrair um resumo do conteúdo
        function extractExcerpt(content, maxLength = 150) {
            // Remover marcações markdown
            const plainText = content
                .replace(/#+\s+(.*)/g, '$1') // Títulos
                .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // Links
                .replace(/[*_]{1,2}([^*_]+)[*_]{1,2}/g, '$1') // Negrito e itálico
                .replace(/`([^`]+)`/g, '$1') // Código inline
                .replace(/```[\s\S]*?```/g, '') // Blocos de código
                .replace(/!\[[^\]]*\]\([^)]+\)/g, '') // Imagens
                .trim();

            // Limitar o tamanho e adicionar reticências se necessário
            if (plainText.length <= maxLength) {
                return plainText;
            }

            return plainText.substring(0, maxLength).trim() + '...';
        }

        // Função para formatar a data
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    // Tentar formato DD/MM/YYYY
                    const parts = dateString.split('/');
                    if (parts.length === 3) {
                        return `${parts[0]}/${parts[1]}/${parts[2]}`;
                    }
                    return dateString;
                }
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });
            } catch (e) {
                console.error("Erro ao formatar data:", e);
                return dateString;
            }
        }

        // Função para carregar todos os artigos
        async function loadAllArticles() {
            document.getElementById('loading').style.display = 'flex';
            console.log('Iniciando carregamento de artigos...');

            try {
                // Obter a lista de arquivos
                const files = await listArticleFiles();
                console.log('Arquivos encontrados:', files);
                
                // Carregar cada arquivo
                const articlesPromises = files.map(file => loadMarkdownFile(file));
                const articles = await Promise.all(articlesPromises);
                console.log('Artigos carregados:', articles.length);

                // Filtrar artigos nulos (que falharam ao carregar)
                loadedArticles = articles.filter(article => article !== null);
                console.log('Artigos válidos:', loadedArticles.length);

                // Ordenar artigos por data (mais recentes primeiro)
                loadedArticles.sort((a, b) => {
                    const dateA = new Date(a.rawDate);
                    const dateB = new Date(b.rawDate);
                    return dateB - dateA;
                });

                // Atualizar o filtro de categorias
                updateCategoryFilter();

                // Exibir todos os artigos
                displayArticles(loadedArticles);

                // Verificar parâmetros na URL
                checkUrlParams();
            } catch (error) {
                console.error('Erro ao carregar artigos:', error);
                document.getElementById('articles-container').innerHTML = '<div class="error-message">Erro ao carregar artigos. Por favor, tente novamente mais tarde.</div>';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Função para atualizar o filtro de categorias
        function updateCategoryFilter() {
            const filterContainer = document.getElementById('category-filter');
            filterContainer.innerHTML = '<button class="category-btn active" data-category="all">Todos</button>';

            // Adicionar botões para cada categoria
            Array.from(categories)
                .filter(category => category !== 'all')
                .sort()
                .forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'category-btn';
                    button.setAttribute('data-category', category);
                    button.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                    filterContainer.appendChild(button);
                });

            // Adicionar evento de clique para os botões de categoria
            const categoryButtons = document.querySelectorAll('.category-btn');
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remover classe 'active' de todos os botões
                    categoryButtons.forEach(btn => btn.classList.remove('active'));

                    // Adicionar classe 'active' ao botão clicado
                    button.classList.add('active');

                    // Filtrar artigos pela categoria
                    const category = button.getAttribute('data-category');
                    filterArticles(category);

                    // Atualizar URL
                    history.pushState({}, '', `?category=${category}`);
                });
            });
        }

        // Função para filtrar artigos por categoria
        function filterArticles(category) {
            let filteredArticles;

            if (category === 'all') {
                filteredArticles = loadedArticles;
            } else {
                filteredArticles = loadedArticles.filter(article => {
                    return article.categories.some(cat => cat.toLowerCase() === category.toLowerCase());
                });
            }

            displayArticles(filteredArticles);
        }

        // Função para exibir os artigos na página
        function displayArticles(articles) {
            const container = document.getElementById('articles-container');
            container.innerHTML = '';

            if (articles.length === 0) {
                container.innerHTML = '<div class="no-articles">Nenhum artigo encontrado.</div>';
                return;
            }

            articles.forEach(article => {
                const articleCard = document.createElement('div');
                articleCard.className = 'article-card';
                articleCard.setAttribute('data-id', article.id);

                // Determinar a categoria principal para exibição
                const mainCategory = article.categories && article.categories.length > 0
                    ? article.categories[0]
                    : 'Sem categoria';

                // Garantir que a imagem seja exibida corretamente
                const imageUrl = article.imagePath || 'img/default-article.jpg';

                // Simplificar o layout do card
                articleCard.innerHTML = `
                    <div class="article-image">
                        <img src="${imageUrl}" alt="${article.title}" onerror="this.src='img/default-article.jpg'">
                    </div>
                    <div class="article-content">
                        <div class="article-meta">
                            <span><i class="far fa-calendar"></i> ${article.date}</span>
                            <span><i class="far fa-folder"></i> ${mainCategory}</span>
                        </div>
                        <h3 class="article-title">${article.title}</h3>
                        <p class="article-excerpt">${article.excerpt}</p>
                    </div>
                `;

                // Fazer o card inteiro ser clicável
                articleCard.addEventListener('click', () => {
                    displayArticle(article.id);
                });

                container.appendChild(articleCard);

                // Verificar se a imagem carregou corretamente
                const img = articleCard.querySelector('img');
                img.addEventListener('error', function() {
                    console.warn(`Imagem não encontrada: ${imageUrl} para o artigo ${article.id}`);
                    this.src = 'img/default-article.jpg';
                });
            });
        }

        // Função para exibir um artigo específico em um modal
        async function displayArticle(articleId) {
            const article = loadedArticles.find(a => a.id === articleId);
            if (!article) {
                alert('Artigo não encontrado!');
                return;
            }

            // Criar o modal se ele ainda não existir
            let modalElement = document.getElementById('article-modal');
            if (!modalElement) {
                modalElement = document.createElement('div');
                modalElement.id = 'article-modal';
                modalElement.className = 'article-modal';
                modalElement.innerHTML = `
                    <div class="article-modal-content">
                        <div class="article-modal-header">
                            <h2 id="modal-article-title"></h2>
                            <button class="modal-close-btn">&times;</button>
                        </div>
                        <div class="article-modal-body">
                            <div class="article-modal-meta">
                                <span id="modal-article-date"></span>
                                <span id="modal-article-category"></span>
                            </div>
                            <div class="article-modal-featured-image">
                                <img id="modal-article-image" src="" alt="">
                            </div>
                            <div id="modal-article-content" class="article-modal-content-body">
                                <p>Carregando conteúdo...</p>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modalElement);
                
                // Adicionar evento para fechar o modal
                modalElement.querySelector('.modal-close-btn').addEventListener('click', () => {
                    modalElement.style.display = 'none';
                    modalElement.classList.remove('glitch');
                    // Atualizar URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const category = urlParams.get('category') || 'all';
                    history.pushState({}, '', `?category=${category}`);
                });
                
                // Fechar o modal ao clicar fora do conteúdo
                modalElement.addEventListener('click', (e) => {
                    if (e.target === modalElement) {
                        modalElement.style.display = 'none';
                        modalElement.classList.remove('glitch');
                        // Atualizar URL
                        const urlParams = new URLSearchParams(window.location.search);
                        const category = urlParams.get('category') || 'all';
                        history.pushState({}, '', `?category=${category}`);
                    }
                });
            }
            
            // Preencher os detalhes básicos do artigo no modal
            document.getElementById('modal-article-title').textContent = article.title;
            document.getElementById('modal-article-date').textContent = article.date;
            document.getElementById('modal-article-category').textContent = article.categories.join(', ');
            document.getElementById('modal-article-image').src = article.imagePath;
            document.getElementById('modal-article-image').alt = article.title;
            
            // Mostrar o modal enquanto carrega o conteúdo
            modalElement.style.display = 'flex';
            modalElement.classList.add('glitch');
            
            // Atualizar URL
            history.pushState({}, '', `?article=${articleId}`);
            
            try {
                console.log('Carregando artigos do JSON...');
                const response = await fetch('./articles.json');
                if (!response.ok) {
                    throw new Error('Falha ao carregar o arquivo JSON');
                }
                
                const articles = await response.json();
                const articleData = articles[articleId];
                
                if (!articleData) {
                    throw new Error('Artigo não encontrado no JSON');
                }
                
                // Renderizar o conteúdo
                document.getElementById('modal-article-content').innerHTML = 
                    DOMPurify.sanitize(articleData.content);
                
                // Aplicar highlight de código após renderizar o conteúdo
                Prism.highlightAllUnder(document.getElementById('modal-article-content'));
                
            } catch (error) {
                console.error('Erro ao carregar artigo:', error);
                document.getElementById('modal-article-content').innerHTML = 
                    `<p>Erro ao carregar o conteúdo: ${error.message}</p>`;
            }
        }

        // Função para verificar parâmetros na URL
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.has('article')) {
                const articleId = urlParams.get('article');
                displayArticle(articleId);
            } else if (urlParams.has('category')) {
                const category = urlParams.get('category');

                // Atualizar botões de categoria
                const categoryButtons = document.querySelectorAll('.category-btn');
                categoryButtons.forEach(btn => {
                    if (btn.getAttribute('data-category') === category) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                filterArticles(category);
            }
        }

        // Variáveis globais
        let loadedArticles = [];
        const categories = new Set(['all']);

        // Função para carregar artigos diretamente
        function loadArticlesDirectly() {
            document.getElementById('loading').style.display = 'flex';
            console.log('Carregando artigos diretamente...');
            
            // Lista estática de artigos baseada nos arquivos markdown disponíveis
            const articles = [
                {
                    id: 'fale-comigo-canal-irc',
                    title: 'Fale comigo pelo IRC via tor',
                    date: '08 de setembro de 2023',
                    rawDate: '2023-09-08',
                    excerpt: 'Seja bem-vindo, este é o primeiro post do meu blog, e vou te ensinar como você pode se conectar comigo via IRC usando uma conexão criptografada via tor.',
                    categories: ['irc'],
                    tags: ['irc', 'portal', 'comunicacao'],
                    imagePath: 'img/robot-irc.png'
                },
                {
                    id: 'comandos-Irssi',
                    title: 'Tutorial de comandos IRC para chat IRSSI',
                    date: '09 de setembro de 2023',
                    rawDate: '2023-09-09',
                    excerpt: 'Este é um guia, um tutorial completo pros amantes do IRC, em especial, pra quem gosta de usar o IRC pelo terminal com IRSSI.',
                    categories: ['irc'],
                    tags: ['irc', 'portal', 'comunicacao', 'comandos'],
                    imagePath: 'img/irc-robot.png'
                },
                {
                    id: 'hexchat-irc',
                    title: 'Como acessar o IRC modo GUI com hexchat',
                    date: '10 de setembro de 2023',
                    rawDate: '2023-09-10',
                    excerpt: 'Sem dúvidas esse é o jeito mais intuitivo para acessar o IRC, se você gosta do modo GUI(Interface Gráfica), este modelo é ideal pra você!',
                    categories: ['irc'],
                    tags: ['irc', 'portal', 'comunicacao', 'tor', 'deepweb'],
                    imagePath: 'img/irc-hexchat.png'
                },
                {
                    id: 'applejuicy',
                    title: 'Ataque de notificações de emparelhagem falsificadas Apple Juice',
                    date: '13 de setembro de 2023',
                    rawDate: '2023-09-13',
                    excerpt: 'Na última defcon edição 31 aconteceu algo que chocou os participantes, os celulares de quem participavam do evento foram inundados de notificações de emparelhamento de dispositivos apple.',
                    categories: ['notices'],
                    tags: ['Apple', 'falha', 'attack', 'defcon'],
                    imagePath: 'img/apple-juicy.png'
                },
                {
                    id: 'os-hackers-no-mundo',
                    title: 'Os hackers no mundo',
                    date: '22 de setembro de 2023',
                    rawDate: '2023-09-22',
                    excerpt: 'Hackers podem ter um impacto positivo no mundo, principalmente para a nossa geração futura.',
                    categories: ['blog', 'artigos', 'hacker'],
                    tags: ['hackers'],
                    imagePath: 'img/hacking-hackers.png'
                },
                {
                    id: 'fbi-hackeado-por-um-troll',
                    title: 'O FBI foi hackeado por um troll',
                    date: '29 de setembro de 2023',
                    rawDate: '2023-09-29',
                    excerpt: 'Por volta das 22 horas do dia 12 de novembro de 2021, um pesquisador de segurança conhecido como Vinny Troia fundador da Night Lion & Shadowbyte recebeu uma mensagem do hacker POMPOMPURIN.',
                    categories: ['notices'],
                    tags: ['hackers', 'hackeado', 'fbi'],
                    imagePath: 'img/fbi-hack.jpg'
                },
                {
                    id: 'seu-celular-te-vigia',
                    title: 'Seu celular te espiona',
                    date: '07 de janeiro de 2024',
                    rawDate: '2024-01-07',
                    excerpt: 'Alguma vez na vida você já falou sobre comprar algo perto do seu smartphone e logo em seguida ao navegar pela rede social deu de cara com um anúncio a respeito do que tinha dito que iria comprar?',
                    categories: ['notices', 'privacidade'],
                    tags: ['espionagem', 'privacidade', 'smartphone', 'segurança', 'vigilância'],
                    imagePath: 'img/celular-espiao.jpg'
                },
                {
                    id: 'os-segredos-do-shodan',
                    title: 'Os segredos do Shodan - Google dos hackers',
                    date: '17 de novembro de 2024',
                    rawDate: '2024-11-17',
                    excerpt: 'Embora eu ame um título persuasivo, não existe segredo algum no Shodan. Entretanto, se você é um pesquisador de segurança, você vai amar esse guia que preparei para você.',
                    categories: ['tutorial'],
                    tags: ['Shodan', 'busca', 'attack', 'web', 'dicas', 'tutorial'],
                    imagePath: 'img/shodan.jpeg'
                }
            ];
            
            // Armazenar artigos na variável global
            loadedArticles = articles;
            
            // Adicionar categorias ao conjunto global
            articles.forEach(article => {
                article.categories.forEach(cat => categories.add(cat.toLowerCase()));
            });
            
            // Atualizar o filtro de categorias
            updateCategoryFilter();
            
            // Exibir todos os artigos
            displayArticles(loadedArticles);
            
            // Verificar parâmetros na URL
            checkUrlParams();
            
            // Ocultar o indicador de carregamento
            document.getElementById('loading').style.display = 'none';
            
            console.log('Artigos carregados com sucesso:', loadedArticles.length);
        }

        // Substituir a chamada para loadAllArticles por loadArticlesDirectly
        document.addEventListener('DOMContentLoaded', loadArticlesDirectly);

        // Lidar com navegação do histórico (botões voltar/avançar do navegador)
        window.addEventListener('popstate', function() {
            checkUrlParams();
        });

        // Botão Voltar ao Topo
        document.querySelector('.back-to-top').addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Mostrar/ocultar botão Voltar ao Topo com base na posição de rolagem
        window.addEventListener('scroll', function() {
            const backToTop = document.querySelector('.back-to-top');
            if (window.scrollY > 300) {
                backToTop.style.opacity = '1';
            } else {
                backToTop.style.opacity = '0';
            }
        });
    </script>
</body>
</html>

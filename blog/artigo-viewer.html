<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carregando Artigo - Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .post-container {
            margin-top: 80px;
            padding: 20px 0;
        }
        
        .post-header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .post-title {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .post-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--text-color);
        }
        
        .post-date {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .post-categories {
            display: flex;
            gap: 10px;
        }
        
        .category-tag {
            background: rgba(255, 62, 120, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: var(--accent-color);
        }
        
        .post-excerpt {
            font-size: 1.2rem;
            color: var(--text-color);
            max-width: 700px;
            margin: 0 auto;
            font-style: italic;
        }
        
        .post-content {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
            color: var(--text-color);
        }
        
        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4 {
            color: var(--light-color);
            margin-top: 40px;
            margin-bottom: 20px;
        }
        
        .post-content h1 {
            font-size: 2.5rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .post-content h2 {
            font-size: 2rem;
            color: var(--accent-color);
        }
        
        .post-content h3 {
            font-size: 1.5rem;
        }
        
        .post-content p {
            margin-bottom: 20px;
        }
        
        .post-content ul,
        .post-content ol {
            margin-bottom: 20px;
            padding-left: 30px;
        }
        
        .post-content li {
            margin-bottom: 8px;
        }
        
        .post-content code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent-color);
        }
        
        .post-content pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .post-content pre code {
            background: none;
            padding: 0;
            color: var(--text-color);
        }
        
        .post-content blockquote {
            border-left: 4px solid var(--accent-color);
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: var(--text-color);
        }
        
        .post-content strong {
            color: var(--light-color);
        }
        
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .post-tags {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .post-tags h4 {
            color: var(--light-color);
            margin-bottom: 15px;
        }
        
        .tags-list {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        .back-to-blog {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--light-color);
            background-color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 30px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 62, 120, 0.3);
            position: static;
        }
        
        .back-to-blog:hover {
            gap: 12px;
            background-color: rgba(255, 62, 120, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 62, 120, 0.5);
        }
        
        .back-to-blog-container {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .back-to-blog {
                margin: 0 auto 20px;
                display: table;
            }
        }
        
        .loading {
            text-align: center;
            padding: 100px 20px;
            color: var(--text-color);
        }
        
        .loading i {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            text-align: center;
            padding: 100px 20px;
            color: var(--accent-color);
        }
        
        .error i {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        /* Ensure content doesn't overlap with fixed header */
        .post-container {
            margin-top: 70px;
            padding: 20px 0;
        }
        
        /* Improve header visibility */
        header {
            background: rgba(0, 0, 0, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <a href="../index.html" class="logo"><span>&lt;/&gt;</span> Al4xs</a>
                <div class="nav-links">
                    <a href="../index.html">Home</a>
                    <a href="../blog.html" class="active">Blog</a>
                    <a href="../python.html">Python</a>
                    <a href="../bash.html">Bash</a>
                    <a href="../links.html">Links</a>
                </div>
                <div class="auth-buttons">
                </div>
            </nav>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container post-container">
        <div class="back-to-blog-container">
            <a href="../blog.html" class="back-to-blog">
                <i class="fas fa-arrow-left"></i> Voltar ao Blog
            </a>
        </div>
        
        <div id="loading" class="loading">
            <i class="fas fa-spinner"></i>
            <h2>Carregando artigo...</h2>
        </div>
        
        <div id="error" class="error" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <h2>Artigo não encontrado</h2>
            <p>O artigo solicitado não foi encontrado ou ocorreu um erro ao carregá-lo.</p>
        </div>
        
        <article id="post" class="post" style="display: none;">
            <header class="post-header">
                <h1 class="post-title" id="postTitle"></h1>
                <div class="post-meta" id="postMeta">
                </div>
                <p class="post-excerpt" id="postExcerpt"></p>
            </header>

            <div class="post-content" id="postContent">
            </div>

            <div class="post-tags" id="postTags">
            </div>
        </article>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="#" class="logo"><span>&lt;/&gt;</span> Al4xs</a>
                    <p class="footer-description">Compartilhando conhecimento sobre segurança, hacking e tecnologia.</p>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-github"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3 class="footer-title">Links Rápidos</h3>
                    <ul>
                        <li><a href="../index.html"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="../blog.html"><i class="fas fa-chevron-right"></i> Blog</a></li>
                        <li><a href="../python.html"><i class="fas fa-chevron-right"></i> Python</a></li>
                        <li><a href="../bash.html"><i class="fas fa-chevron-right"></i> Bash</a></li>
                        <li><a href="../links.html"><i class="fas fa-chevron-right"></i> Links</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <p>&copy; 2024 Al4xs. Todos os direitos reservados.</p>
                <a href="#" class="back-to-top"><i class="fas fa-arrow-up"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Configure marked options
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // Get article filename from URL parameter with security checks
        function getArticleFilename() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleParam = urlParams.get('article');
            
            // Security checks
            if (!articleParam) {
                return null;
            }
            
            // Prevent directory traversal attacks
            if (articleParam.includes('../') || articleParam.includes('./') || 
                articleParam.includes('..\\') || articleParam.includes('.\\') ||
                articleParam.startsWith('/') || articleParam.startsWith('\\') ||
                !articleParam.endsWith('.md')) {
                console.error('Tentativa de acesso inválido detectada');
                return null;
            }
            
            // Whitelist de arquivos permitidos
            const allowedArticles = [
                'artigo1.md',
                'ataque-falsificacao-blee.md'
                // Adicione aqui outros artigos permitidos
            ];
            
            if (!allowedArticles.includes(articleParam)) {
                console.error('Artigo não está na lista de permitidos');
                return null;
            }
            
            return articleParam;
        }

        // Parse front matter from markdown
        function parseMarkdownFrontMatter(content) {
            const frontMatterMatch = content.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
            
            if (!frontMatterMatch) {
                return {
                    title: 'Artigo sem título',
                    date: new Date().toISOString().split('T')[0],
                    categories: [],
                    tags: [],
                    excerpt: '',
                    content: content
                };
            }
            
            const frontMatter = frontMatterMatch[1];
            const markdownContent = frontMatterMatch[2];
            
            // Parse YAML-like front matter
            const lines = frontMatter.split('\n');
            const data = {};
            
            lines.forEach(line => {
                const colonIndex = line.indexOf(':');
                if (colonIndex > 0) {
                    const key = line.substring(0, colonIndex).trim();
                    let value = line.substring(colonIndex + 1).trim();
                    
                    // Remove quotes
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    
                    // Parse arrays
                    if (value.startsWith('[') && value.endsWith(']')) {
                        value = value.slice(1, -1).split(',').map(item => item.trim().replace(/"/g, ''));
                    }
                    
                    data[key] = value;
                }
            });
            
            return {
                title: data.title || 'Artigo sem título',
                date: data.date || new Date().toISOString().split('T')[0],
                categories: data.categories || [],
                tags: data.tags || [],
                excerpt: data.excerpt || '',
                content: markdownContent
            };
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Load and render article with additional security
        async function loadArticle() {
            const filename = getArticleFilename();
            
            if (!filename) {
                showError('Artigo inválido ou não encontrado');
                return;
            }
            
            try {
                // Sanitize the path and use a consistent format
                const sanitizedPath = filename.replace(/[^\w.-]/g, '');
                
                // Additional security check
                if (sanitizedPath !== filename) {
                    throw new Error('Caminho do arquivo inválido');
                }
                
                // Tenta buscar o arquivo Markdown
                let response;
                try {
                    response = await fetch(`../blog/${sanitizedPath}`, {
                        method: 'GET',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    if (!response.ok) {
                        // Se não conseguir carregar, tenta com caminho alternativo
                        response = await fetch(`./${sanitizedPath}`, {
                            method: 'GET',
                            headers: {
                                'Cache-Control': 'no-cache',
                                'X-Requested-With': 'XMLHttpRequest'
                            }
                        });
                    }
                } catch (fetchError) {
                    console.error("Erro ao buscar arquivo:", fetchError);
                    throw new Error('Artigo não encontrado');
                }
                
                let markdownContent;
                let articleData;
                
                if (!response.ok) {
                    // Se não conseguir carregar o arquivo, usa dados de fallback
                    console.warn(`Arquivo ${sanitizedPath} não encontrado, usando dados de fallback`);
                    articleData = getArticleFallbackData(sanitizedPath);
                } else {
                    markdownContent = await response.text();
                    
                    // Validate content before processing
                    if (!markdownContent || markdownContent.length > 500000) { // Limite de tamanho
                        throw new Error('Conteúdo inválido');
                    }
                    
                    articleData = parseMarkdownFrontMatter(markdownContent);
                }
                
                // Update page title with sanitization
                document.title = `${(articleData.title || '').replace(/[<>]/g, '')} - Blog`;
                
                // Render article
                renderArticle(articleData);
                
            } catch (error) {
                console.error('Erro ao carregar artigo:', error);
                showError(error.message);
            }
        }

        // Render article content
        function renderArticle(articleData) {
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Show article
            const post = document.getElementById('post');
            post.style.display = 'block';
            
            // Set title
            document.getElementById('postTitle').textContent = articleData.title;
            
            // Set meta
            const postMeta = document.getElementById('postMeta');
            postMeta.innerHTML = `
                <span class="post-date">
                    <i class="far fa-calendar-alt"></i>
                    ${formatDate(articleData.date)}
                </span>
                <div class="post-categories">
                    ${articleData.categories.map(cat => `<span class="category-tag">${cat}</span>`).join('')}
                </div>
            `;
            
            // Set excerpt
            document.getElementById('postExcerpt').textContent = articleData.excerpt;
            
            // Render content
            const postContent = document.getElementById('postContent');
            postContent.innerHTML = marked.parse(articleData.content);
            
            // Set tags
            if (articleData.tags.length > 0) {
                const postTags = document.getElementById('postTags');
                postTags.innerHTML = `
                    <h4>Tags:</h4>
                    <div class="tags-list">
                        ${articleData.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                `;
            }
        }

        // Show error with custom message
        function showError(message = 'Artigo não encontrado ou ocorreu um erro ao carregá-lo.') {
            document.getElementById('loading').style.display = 'none';
            
            const errorElement = document.getElementById('error');
            const errorMessageElement = errorElement.querySelector('p');
            
            if (errorMessageElement) {
                errorMessageElement.textContent = message;
            }
            
            errorElement.style.display = 'block';
            
            // Log de segurança
            console.warn('Erro de acesso ao artigo:', message);
            
            // Redirecionar para o blog após 5 segundos em caso de erro
            setTimeout(() => {
                window.location.href = '../blog.html';
            }, 5000);
        }
        
        // Dados de fallback para quando os arquivos Markdown não podem ser carregados
        function getArticleFallbackData(filename) {
            const fallbackData = {
                'artigo1.md': {
                    title: "Hackers no mundo",
                    date: "2024-01-15",
                    categories: ["Segurança", "Hacking"],
                    tags: ["hacking", "segurança", "pentest", "cybersecurity"],
                    excerpt: "Hackers podem ter um impacto positivo no mundo, principalmente para a nossa geração futura.",
                    content: `
## Hackers no mundo

Hackers podem ter um impacto positivo no mundo, principalmente para a nossa geração futura.

Meu nome é Michael Silva, mas sou conhecido como Al4xs. Trabalho como consultor de segurança cibernética ajudando a tornar empresas mais seguras, já atuei nas áreas mais distintas em testes de aplicativos e aplicações, infraestrutura, investigação, inteligência de ameaças e até contrainteligência. E nas horas vagas faço a mesma coisa como hobbie, gosto de hackear coisas, jogar desafios de capturar bandeiras, fazer descobertas, sou um amante de computadores. Sim, este é meu mundo.

A razão pelo qual estou aqui hoje não é pelos noticiários, como:

Hackers desviaram milhões, mais uma vez. Hackers invadiram empresas e pedem resgate, mais uma vez. Hacker foi preso. Hackers, hackers, hackers.

Nós ainda vivemos em um mundo anti-hacker.

Só que hackers podem ser herois, se eles quiserem. Veja, eu não sou futurista e nunca inventei nada para o futuro, mas posso fazer uma previsão em relação a nossa técnologia e o futuro em relação ao espaço cibernético. Embora não dê pra advinhar e ser preciso sobre o que virá porque a tecnologia está avançando e cada mais rápido.

Se deixarmos nossa tecnologia apenas nas mãos do governo e de empresas que só pensam em lucrar, advinhem… eles irão fracassar!

Pra ser sincero, não imagino um mundo tecnologico seguro sem hackers. E nosso futuro é tecnologico.

A técnologia controla as mais diversas coisas que você pode imaginar, desde barcos de guerra, sistema de mísseis, robos exploradores de marte, frequencias de radio, carros, usinas, talvez até a torradeira da sua mãe e seu relógio de pulso.

# Segurança

Imagine todos os mais diversos dispositivos vulneraveis, imagine o caos. Porque eu não conheço nenhuma instituição ou entidade do governo que cuida disso, que são preparados para promover a segurança na internet, e você também não.

Como você acha que vão corrigir falhas que eles nem sabem que existem?

Inclusive isso me lembra uma frase de Barnaby Michael Douglas Jack, que dizia: "É preciso demonstrar uma ameaça para que possamos desencadear uma solução"

Como muitos conhecem, ele foi o pesquisador que demonstrou como era possível fazer caixas cuspirem dinheiro remotamente, através da maior conferência hacker do mundo, a defcon.

Infelizmente em 2013 depois de ter revelado a falha que chamou de jackpotting, ele foi encontrado morto em seu apartamento. Talvez porque alguém achou que esta falha era muito perigosa para ser exposta publicamente.

Nós sabemos que mesmo com boas intenções, empresas e fornecedores não conseguirão manter a nossa segurança, nem com todos os seus esforços, e sabemos também que nem todas empresas e fornecedores são bem intencionadas.`
                },
                'ataque-falsificacao-blee.md': {
                    title: "Ataque de notificações de emparelhagem falsificadas Apple Juice",
                    date: "2025-01-02",
                    categories: ["Segurança", "Hacking"],
                    tags: ["hacking", "mobile", "bluetooth", "ataque"],
                    excerpt: "Ataque via bluetooth",
                    content: `
# DEFCON 31
Na última defcon edição 31 aconteceu algo que chocou os participantes, os celulares de quem participavam do evento foram inundados de notificações de emparelhamento de dispositivos apple, como: Airpods, Apple TV, Smarth Watch, etc.

A tela do celular não ficava em paz, você rejeitava uma solicitação, chegava outra.

Mais tarde no mastodon após membros comentarem sobre as notificações, um pesquisador conhecido como Jae Bochs respondeu a todos afirmando que tudo não passava de uma brincadeira que ele resolveu fazer no dia do evento com sua nova descoberta.

# O que é esse ataque?

Conhecido como \`"Apple Juice"\` este ataque consiste em explorar as requisições via bluetooth para emparelhamento entre dispositivos.

O BLEE (Bluetooth Low-Energy) é uma biblioteca que se comunica com aparelhos da apple através de um popup de solicitação inicial para emparelhar dispositivos para que futuramente os IOT's se conectem ao dispositivo automaticamente.

Bochs ainda disse que o experimento não foi criado para roubar dados, apenas para enviar pacotes de publicidade bluetooth que não requerem emparelhamento( E como tal não são interrompidos pela alternancia do centro de controle.) Entretanto, ainda que você desligue o bluetooth pela central de controle da apple, você receberá a inundação de popups e seu bluetooth será ligado instantaneamente.`
                }
            };
            
            return fallbackData[filename] || {
                title: 'Artigo não encontrado',
                date: new Date().toISOString().split('T')[0],
                categories: [],
                tags: [],
                excerpt: 'Este artigo não está disponível.',
                content: '# Artigo não encontrado\n\nO artigo solicitado não está disponível no momento.'
            };
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>
</html>
